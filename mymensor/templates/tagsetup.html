{% extends 'base.html' %}
{% load staticfiles i18n mymfilters%}
{% if user.is_authenticated %}
    {% block title %}TAGs Setup - {{ block.super }}{% endblock %}
    {% block header %}
    {% endblock %}
    {% block content %}
        <div class="mym-dash">
            <div class="d-flex flex-row justify-content-start align-items-center flex-wrap">
                <div id="vpselector" class="mym-dash-item">
                    <select id="currvp">
                        {% for vp in vps %}
                            <option value="{{ vp.vpNumber }}" {% if vp.vpNumber == currentvp %}selected{% endif %}>VP#{{ vp.vpNumber }} - {{ vp.vpDescription }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div id="tagselectorforeachvp" class="mym-dash-item">
                    <select id="currtag">
                        {% for tag in tags %}
                            <option value="{{ tag.tagNumber }}" {% if tag.tagNumber == currenttag %}selected{% endif %}>TAG#{{ tag.tagNumber }} - {{ tag.tagDescription }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div id="tagstotalqtyselector" class="mym-dash-item">
                    <button id="inctags" type="button" class="btn btn-outline-primary">{% trans 'Increase tag qty in VP#' %}{{ currentvp }}</button>
                </div>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col">
                <p></p>
            </div>
            <div class="col-4">
                <div id="tagedition">
                    <form role="form" action="." method="post"> {% csrf_token %}
                        {% if form.non_field_errors %}
                        <div class="alert alert-danger">{{ form.non_field_errors|join:"<br \>" }}</div>
                        {% endif %}
                        {% for hidden in form.hidden_fields %}
                            {{ hidden }}
                        {% endfor %}
                        {% for field in form.visible_fields %}
                        <div class="form-group {% if field.errors %}has-error{% endif %}">
                            {{ field.label_tag|add_class:"control-label" }}
                            {% if field.help_text %}
                            <span class="help-block">{{ field.help_text }}</span>
                            {% endif %}
                            {% if field.errors %}
                            <span class="help-block">{{ field.errors|join:"<br \>" }}</span>
                            {% endif %}
                            {{ field|add_class:"form-control" }}
                        </div>
                        {% endfor %}
                        <input type="hidden" name="currentvp" value="{{ currentvp }}">
                        <input type="hidden" name="currenttag" value="{{ currenttag }}">
                        <input class="btn btn-success" type="submit" value="{% trans 'Submit' %}">
                    </form>
                </div>
            </div>
        </div>
    {% endblock %}
    {% block javascript %}
        <script type="text/javascript">
        $('#currvp').chosen();
        $('#currtag').chosen();
        $(function(){

            var qttags = {{ qtytags }};
            var qtvps = {{ qtyvps }};

            $('#currtag').change(function(){
                var tagselected = $(this).find(":selected").val();
                console.log("TAGSELECTED: qtvps="+qtvps+" qttags="+qttags+" vpselected="+'{{ currentvp }}'+" tagselected="+tagselected);
                window.location={% url 'tagsetup' %}+'?qtyvps='+'{{ qtyvps }}'+'&currentvp='+'{{ currentvp }}'+'&qtytags='+'{{ qtytags }}'+'&currenttag='+tagselected;
            });

            console.log("INITIAL: qtvps="+qtvps+" qttags="+qttags+" vpselected="+'{{ currentvp }}'+" tagselected="+'{{ currenttag }}');

            $('#currvp').change(function(){
                var vpselected = $(this).find(":selected").val();
                console.log("VPSELECTED: qtvps="+qtvps+" qttags="+qttags+" vpselected="+vpselected+" tagselected="+'{{ currenttag }}');
                window.location={% url 'tagsetup' %}+'?qtyvps='+'{{ qtyvps }}'+'&currentvp='+vpselected+'&qtytags='+'{{ qtytags }}'+'&currenttag='+'{{ currenttag }}';
            });

            $('#inctags').click(function(){
                console.log("Clicked on inctags!!!!");
                qttags = qttags + 1;
                console.log("INCTAGSCLICKED: qtvps="+qtvps+" qttags="+qttags+" vpselected="+'{{ currentvp }}'+" tagselected="+qttags);
                window.location={% url 'tagsetup' %}+'?qtyvps='+'{{ qtyvps }}'+'&currentvp='+'{{ currentvp }}'+'&qtytags='+qttags+'&currenttag='+qttags;
            });

        });
        </script>
    {% endblock %}
{% else %}
    <h1>Not Logged In....</h1>
{% endif %}
