{% extends 'base.html' %}
{% load i18n tz mymfilters %}
{% localtime on %}
    {% get_current_timezone as TIME_ZONE %}
    {% if user.is_authenticated %}
        {% block title %}{% trans "Subscription" %} - {{ block.super }}{% endblock %}
        {% block header %}
        {% endblock %}
        {% block content %}
            <div class="container">
                {% if btsubscription is not None %}
                    <div class="row" style="padding-top:20px">
                        <h3>{% trans "Current MyMensor Plan" %}</h3>
                    </div>
                    <div class="row" style="padding-bottom: 20px">
                        <div class="col">
                            <p>{% trans "Thanks for using our Apps!" %}</p>
                            <p>
                                {% trans "Right now you are using the <b>" %}{{ currentuserplan }}{% trans " Plan</b>    " %}
                                {% if currentuserplan == "MyMensor Media and Data" %}
                                    <button id="changeplanbtbn" type="button"
                                            class="btn btn-outline-info"
                                            style="margin-left: 10px">{% trans "Take me to the <b>MyMensor Media Plan</b>" %}</button>
                                {% else %}
                                    <button id="changeplanbtbn" type="button"
                                            class="btn btn-outline-info"
                                            style="margin-left: 10px">{% trans "Take me to the <b>MyMensor Media and Data Plan</b>" %}</button>
                                {% endif %}
                            </p>
                            <p></p>
                            {% if currentuserplan == "MyMensor Media and Data" %}
                                <p>{% trans "This plan allows you to store <u>both media and data</u> in our servers. Your media will always be organized in the way you wish and you will be able to share it automatically in Twitter of email. By using this plan you can further analyse the data generated with your media captures, using the Data menu." %}</p>
                            {% else %}
                                <p>{% trans "This plan allows you to store <u>media</u> in our servers. Your media will always be organized in the way you wish and you will be able to share it automatically in Twitter or email. If you need to store and <b>explore data together with your media</b>, please consider <b>upgrading to the Media and Data Plan!</b>" %}</p>
                            {% endif %}
                            {% if btsubscription.braintreesubscriptionSubscriptionStatus == "Empty" %}
                                <p>
                                    {% trans "You are currently on a trial period that will extend for another " %}{{ dateofendoftrialbeforesubscription|timeuntil }}</p>
                                <p></p>
                                <a class="btn btn-primary" href="{% url 'createsubscription' %}"
                                   role="button">
                                    {% trans "I want to subscribe to <b>" %}{{ currentuserplan }}{% trans " Plan</b> NOW!" %}</a>
                            {% endif %}
                        </div>
                    </div>
                    {% if btsubscription.braintreesubscriptionSubscriptionStatus == "Active" %}
                        <div class="row">
                            <h3>{% trans "Current Rate, Currency and Payment Method" %}</h3>
                        </div>
                        {% if succesful is True %}
                            <div class="row" style="padding-bottom: 20px">
                                <div class="col">
                                    <p>{% trans "Your payment method was succesfully modified to the one listed below:" %}</p>
                                </div>
                            </div>
                        {% endif %}
                        {% if succesful is False %}
                            <div class="row" style="padding-bottom: 20px">
                                <div class="col">
                                    <p>{% trans "We could not modify your payment method, please see result:" %}</p>
                                    <p>{{ result }}</p>
                                </div>
                            </div>
                        {% endif %}
                        <div class="row">
                            <div class="col">
                                <p>{% trans "You are currently paying " %}{{ btmercht.braintreemerchCurrency }} {{ btprice.braintrepricePrice }} {% trans " per month using the following payment method." %}</p>
                            </div>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col-lg-5">
                                {% if btsubscription.braintreesubscriptionPaymentInstrumentType == "credit_card" %}
                                    <ul class="list-group">
                                        <li class="list-group-item"><img
                                                src="{{ btsubscription.braintreesubscriptionPaymentImageURL }}"
                                                style="padding-right: 12px;"> {{ btsubscription.braintreesubscriptionCClast4 }}
                                        </li>
                                        <li class="list-group-item">{{ btsubscription.braintreesubscriptionCCexpmonth }}
                                            / {{ btsubscription.braintreesubscriptionCCexpyear }}</li>
                                    </ul>
                                {% endif %}
                                {% if btsubscription.braintreesubscriptionPaymentInstrumentType == "paypal_account" %}
                                    <ul class="list-group">
                                        <li class="list-group-item"><img
                                                src="{{ btsubscription.braintreesubscriptionPaymentImageURL }}"
                                                style="padding-right: 12px;"> {{ btsubscription.braintreesubscriptionPayPalEmail }}
                                        </li>
                                    </ul>
                                {% endif %}
                            </div>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col">
                                <a href="{% url 'modifypaymentmethod' %}" class="btn btn-outline-info"
                                   role="button">{% trans "Modify Current Payment Method" %}</a>
                            </div>
                        </div>
                        <div class="row" style="padding-top:10px">
                            <h3>{% trans "Cancel Subscription" %}</h3>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col ">
                                <p>{% trans "Press the button below to cancel your subscription. Nonetheless, you will be able to use your current account until the end of the present subscription period." %}</p>
                                <p>
                                    {% trans "Your subscription is paid through " %}{{ btsubscription.braintreesubscriptionLastDay | localtime | date:"Y-b-d H:i:sO" }}</p>
                                <a id="cancel-subscription" class="btn btn-outline-danger text-danger"
                                   role="button">{% trans "Cancel Subscription" %}</a>
                            </div>
                        </div>
                    {% elif btsubscription.braintreesubscriptionSubscriptionStatus == "Canceled" %}
                        <div class="row">
                            <h3>{% trans "Thanks for using Mymensor!" %}</h3>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col">
                                <p>{% trans "Your present subscription is canceled. " %}</p>
                                <p>{% trans "You are using the " %}{{ currentuserplan }}{% trans " Plan" %}</p>
                                <p>{% trans "If you would like to subscribe again to our service, please press the button below." %}</p>
                            </div>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col">
                                <a class="btn btn-primary" href="{% url 'createsubscription' %}"
                                   role="button">{% trans "Subscribe Again Now!" %}</a>
                            </div>
                        </div>
                    {% elif btsubscription.braintreesubscriptionSubscriptionStatus == "Unsuccessful" %}
                        <div class="row">
                            <h3>{% trans "Thanks for using Mymensor!" %}</h3>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col">
                                <p>{% trans "Your last attempt to subscribe was unsuccessful. " %}</p>
                                <p>{% trans "If you would like to try again to subscribe to our service, please press the button below." %}</p>
                            </div>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col">
                                <a class="btn btn-primary" href="{% url 'createsubscription' %}"
                                   role="button">{% trans "Subscribe Now!" %}</a>
                            </div>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="row">
                        <h3>{% trans "Thanks for registering with Mymensor and using our Apps!" %}</h3>
                    </div>
                    <div class="row" style="padding-bottom: 20px">
                        <div class="col">
                            <p>
                                {% trans "Right now you are using the <b>" %}{{ currentuserplan }}{% trans " Plan</b>    " %}
                                {% if currentuserplan == "MyMensor Media and Data" %}
                                    <button id="changeplanbtbn" type="button"
                                            class="btn btn-outline-info"
                                            style="margin-left: 10px">{% trans "Take me to the <b>MyMensor Media Plan</b>" %}</button>
                                {% else %}
                                    <button id="changeplanbtbn" type="button"
                                            class="btn btn-outline-info"
                                            style="margin-left: 10px">{% trans "Take me to the <b>MyMensor Media and Data Plan</b>" %}</button>
                                {% endif %}
                            </p>
                            <p></p>
                            {% if currentuserplan == "MyMensor Media and Data" %}
                                <p>{% trans "This plan allows you to store <u>both media and data</u> in our servers. Your media will always be organized in the way you wish and you will be able to share it automatically in Twitter of email. By using this plan you can further analyse the data generated with your media captures, using the Data menu." %}</p>
                            {% else %}
                                <p>{% trans "This plan allows you to store <u>media</u> in our servers. Your media will always be organized in the way you wish and you will be able to share it automatically in Twitter of email. If you need to store data together with your media, please consider upgrading to the Media and Data Plan!" %}</p>
                            {% endif %}
                            <p>
                                {% trans "You are currently on a trial period that will extend for another " %}{{ dateofendoftrialbeforesubscription|timeuntil }}</p>
                            <p></p>
                            <a class="btn btn-primary" href="{% url 'createsubscription' %}"
                               role="button">
                                {% trans "I want to subscribe to <b>" %}{{ currentuserplan }}{% trans " Plan</b> NOW!" %}</a>
                        </div>
                    </div>
                {% endif %}
                <div class="row" style="padding-top:10px">
                    <h3>{% trans "Your Activity at MyMensor" %}</h3>
                </div>
                <div class="row" style="padding-bottom: 20px">
                    <div class="col">
                        <p>
                            {% trans "First Login: " %}{{ userloggedin.date_joined | localtime | date:"Y-b-d H:i:sO" }}</p>
                        <p>{% trans "Last Login: " %}{{ userloggedin.last_login | localtime | date:"Y-b-d H:i:sO" }}</p>
                        <p>{% trans "You have " %}<b>{{ mediaqty }}</b>{% trans " medias stored in our servers." %}</p>
                        {% if currentuserplan == "MyMensor Media and Data" %}
                            <p>
                                {% trans "There are " %}<b>{{ tagqty }}</b>{% trans " TAGs configured to process your data." %}
                            </p>
                            <p>
                                {% trans "You have processed a total of " %}<b>{{ processedtagqty }}</b>{% trans " TAG instances so far." %}
                            </p>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endblock %}
        {% block javascript %}
            <script type="text/javascript">
                $('#cancel-subscription').click(function () {
                    swal({
                        title: "{% trans "Please confirm that you want to cancel your subscription." %}",
                        type: 'warning',
                        showCancelButton: true,
                        confirmButtonText: '{{ swalchgbtnconfirmButtonText }}',
                        cancelButtonText: '{{ swalchgbtncancelButtonText }}',
                        confirmButtonClass: 'btn btn-success',
                        cancelButtonClass: 'btn btn-danger'
                    }).then(function () {
                        swal({
                            title: '{{ swalchgbtnsuccesstitle }}',
                            type: 'success',
                            showConfirmButton: false
                        });
                        window.location = "{% url 'deletesubscription' %}";
                    }, function (dismiss) {
                        // dismiss can be 'cancel', 'overlay',
                        // 'close', and 'timer'
                        if (dismiss === 'cancel') {
                            swal({
                                title: '{{ swalchgbtncanceltitle }}',
                                type: 'error',
                                showConfirmButton: false,
                                timer: 1000
                            });
                        }
                    }).catch(swal.noop);
                });
                $('#changeplanbtbn').click(function () {
                    swal({
                        title: '{{ swalchgbtntitle }}',
                        {% if btsubscription.braintreesubscriptionSubscriptionStatus == "Active" %}
                            text: '{{ swalchgbtntext }}',
                        {% endif %}
                        type: 'warning',
                        showCancelButton: true,
                        confirmButtonText: '{{ swalchgbtnconfirmButtonText }}',
                        cancelButtonText: '{{ swalchgbtncancelButtonText }}',
                        confirmButtonClass: 'btn btn-success',
                        cancelButtonClass: 'btn btn-danger'
                    }).then(function () {
                        swal({
                            title: '{{ swalchgbtnsuccesstitle }}',
                            type: 'success',
                            showConfirmButton: false
                        });
                        {% if btsubscription.braintreesubscriptionSubscriptionStatus == "Active" %}
                            window.location = "{% url 'changesubscriptionplan' %}";
                        {% else %}
                            window.location = "{% url 'chgplan' %}";
                        {% endif %}
                    }, function (dismiss) {
                        // dismiss can be 'cancel', 'overlay',
                        // 'close', and 'timer'
                        if (dismiss === 'cancel') {
                            swal({
                                title: '{{ swalchgbtncanceltitle }}',
                                type: 'error',
                                showConfirmButton: false,
                                timer: 1000
                            });
                        }
                    }).catch(swal.noop);
                });

            </script>
        {% endblock %}
    {% else %}
        <h1>Not Logged In....</h1>
    {% endif %}
{% endlocaltime %}

