{% extends 'base.html' %}
{% load i18n tz mymfilters %}
{% localtime on %}
    {% get_current_timezone as TIME_ZONE %}
    {% if user.is_authenticated %}
        {% block title %}{% trans "Subscription" %} - {{ block.super }}{% endblock %}
        {% block header %}
        {% endblock %}
        {% block content %}
            <div class="container">
                <div class="row" style="padding-top:20px; padding-bottom: 20px">
                    <h3>{% trans "Your Activity at MyMensor" %}</h3>
                </div>
                <div class="row" style="padding-bottom: 20px">
                    <div class="col-lg-8">
                        <p>{% trans "You are using the " %}{{ currentuserplan }}{% trans " Plan" %}</p>
                        {% if currentuserplan == "MyMensor Media and Data" %}
                            <p>{% trans "This plan allows you to store <u>both media and data</u> in our servers. Your media will always be organized in the way you wish and you will be able to share it automatically in Twitter of email. By using this plan you can further analyse the data generated with your media captures, using the Data menu." %}</p>
                        {% else %}
                            <p>{% trans "This plan allows you to store <u>media</u> in our servers. Your media will always be organized in the way you wish and you will be able to share it automatically in Twitter of email. If you need to store data together with your media, please consider upgrading to the Media and Data Plan!" %}</p>
                        {% endif %}
                        <p>
                            {% trans "First Login: " %}{{ userloggedin.date_joined | localtime | date:"Y-b-d H:i:sO" }}</p>
                        <p>{% trans "Last Login: " %}{{ userloggedin.last_login | localtime | date:"Y-b-d H:i:sO" }}</p>
                        <p>{% trans "You have " %}<u>{{ mediaqty }}</u>{% trans " medias stored in our servers." %}</p>
                        {% if currentuserplan == "MyMensor Media and Data" %}
                            <p>
                                {% trans "There are " %}<u>{{ tagqty }}</u>{% trans " TAGs configured to process your data." %}
                            </p>
                            <p>
                                {% trans "You have processed a total of " %}<u>{{ processedtagqty }}</u>{% trans " TAG instances so far." %}
                            </p>
                        {% endif %}
                        {% if currentuserplan == "MyMensor Media and Data" and tagqty == 0 %}
                            <div class="alert alert-danger" role="alert">
                                <strong>Attention!</strong> Currently you are not using any TAGs then most probably you
                                can save some money by changing your plan to MEDIA only. Please check our docs!
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% if btsubscription is not None %}
                    {% if btsubscription.braintreesubscriptionSubscriptionStatus == "Active" %}
                        <div class="row" style="padding-bottom: 20px">
                            <h3>{% trans "Current Payment Method" %}</h3>
                        </div>
                        {% if succesful is True %}
                            <div class="row" style="padding-bottom: 20px">
                                <div class="col-lg-8">
                                    <p>{% trans "Your payment method was succesfully modified to the one listed below:" %}</p>
                                </div>
                            </div>
                        {% endif %}
                        {% if succesful is False %}
                            <div class="row" style="padding-bottom: 20px">
                                <div class="col-lg-8">
                                    <p>{% trans "We could not modify your payment method, please see result:" %}</p>
                                    <p>{{ result }}</p>
                                </div>
                            </div>
                        {% endif %}
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col-lg-5">
                                {% if btsubscription.braintreesubscriptionPaymentInstrumentType == "credit_card" %}
                                    <ul class="list-group">
                                        <li class="list-group-item"><img
                                                src="{{ btsubscription.braintreesubscriptionPaymentImageURL }}"
                                                style="padding-right: 12px;"> {{ btsubscription.braintreesubscriptionCClast4 }}
                                        </li>
                                        <li class="list-group-item">{{ btsubscription.braintreesubscriptionCCexpmonth }}
                                            / {{ btsubscription.braintreesubscriptionCCexpyear }}</li>
                                    </ul>
                                {% endif %}
                                {% if btsubscription.braintreesubscriptionPaymentInstrumentType == "paypal_account" %}
                                    <ul class="list-group">
                                        <li class="list-group-item"><img
                                                src="{{ btsubscription.braintreesubscriptionPaymentImageURL }}"
                                                style="padding-right: 12px;"> {{ btsubscription.braintreesubscriptionPayPalEmail }}
                                        </li>
                                    </ul>
                                {% endif %}
                            </div>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col-lg-8">
                                <a href="{% url 'modifypaymentmethod' %}" class="btn btn-outline-info"
                                   role="button">{% trans "Modify Current Payment Method" %}</a>
                            </div>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <h3>{% trans "Cancel Subscription" %}</h3>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col-lg-8 ">
                                <p>{% trans "Press the button below to cancel your subscription. Nonetheless, you will be able to use your current account until the end of the present subscription period." %}</p>
                                <p>
                                    {% trans "Your subscription is paid through " %}{{ btsubscription.braintreesubscriptionLastDay | localtime | date:"Y-b-d H:i:sO" }}</p>
                                <a id="cancel-subscription" class="btn btn-outline-danger text-danger"
                                   role="button">{% trans "Cancel Subscription" %}</a>
                            </div>
                        </div>
                    {% elif btsubscription.braintreesubscriptionSubscriptionStatus == "Empty" %}
                        <div class="row" style="padding-bottom: 20px">
                            <h3>{% trans "Thanks for registering with Mymensor and using our Apps!" %}</h3>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col-lg-8 ">
                                <p>{% trans "Right now you are using the " %}{{ currentuserplan }}{% trans " Plan " %}
                                    <button id="changeplanbtbn" type="button"
                                            class="btn btn-outline-primary">{% trans "If you wish to do so, press here to change Plan!" %}</button>
                                </p>
                                <p></p>
                                <p>
                                    {% trans "You are currently on a trial period that will extend for another " %}{{ dateofendoftrialbeforesubscription|timeuntil }}</p>
                                <p>{% trans "If you would like to subscribe to our service, please press the button below." %}</p>
                                <p></p>
                                <a class="btn btn-primary" href="{% url 'createsubscription' %}"
                                   role="button">{% trans "Subscribe Now!" %}</a>
                            </div>
                        </div>
                    {% elif btsubscription.braintreesubscriptionSubscriptionStatus == "Canceled" %}
                        <div class="row" style="padding-bottom: 20px">
                            <h3>{% trans "Thanks for using Mymensor!" %}</h3>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col-lg-8 ">
                                <p>{% trans "Your present subscription is canceled. " %}</p>
                                <p>{% trans "You are using the " %}{{ currentuserplan }}{% trans " Plan" %}</p>
                                <p>{% trans "If you would like to subscribe again to our service, please press the button below." %}</p>
                            </div>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col-lg-8 ">
                                <a class="btn btn-primary" href="{% url 'createsubscription' %}"
                                   role="button">{% trans "Subscribe Again Now!" %}</a>
                            </div>
                        </div>
                    {% elif btsubscription.braintreesubscriptionSubscriptionStatus == "Unsuccessful" %}
                        <div class="row" style="padding-bottom: 20px">
                            <h3>{% trans "Thanks for using Mymensor!" %}</h3>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col-lg-8 ">
                                <p>{% trans "Your last attempt to subscribe was unsuccessful. " %}</p>
                                <p>{% trans "If you would like to try again to subscribe to our service, please press the button below." %}</p>
                            </div>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col-lg-8 ">
                                <a class="btn btn-primary" href="{% url 'createsubscription' %}"
                                   role="button">{% trans "Subscribe Now!" %}</a>
                            </div>
                        </div>
                    {% else %}
                        <div class="row" style="padding-bottom: 20px">
                            <h3>{% trans "Current Subscription Status" %}</h3>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col-lg-8 ">
                                <p>
                                    {% trans "You are using the " %}{{ currentuserplan | timeuntil }}{% trans " Plan" %}</p>
                                <p>
                                    {% trans "Status: " %}{{ btsubscription.braintreesubscriptionSubscriptionStatus }}</p>
                            </div>
                        </div>
                        <div class="row" style="padding-bottom: 20px">
                            <div class="col-lg-8 ">
                                <p>{% trans "If you wish, please contact support about your current status." %}</p>
                            </div>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="row" style="padding-bottom: 20px">
                        <h3>{% trans "Thanks for registering with Mymensor and using our Apps!" %}</h3>
                    </div>
                    <div class="row" style="padding-bottom: 20px">
                        <div class="col-lg-8 ">
                            <p>{% trans "Right now you are using the " %}{{ currentuserplan }}{% trans " Plan " %}
                                <button id="changeplanbtbn" type="button"
                                        class="btn btn-outline-primary">{% trans "If you wish to do so, press here to change Plan!" %}</button>
                            </p>
                            <p></p>
                            <p>
                                {% trans "You are currently on a trial period that will extend for another " %}{{ dateofendoftrialbeforesubscription|timeuntil }}</p>
                            <p>{% trans "If you would like to subscribe to our service, please press the button below." %}</p>
                            <p></p>
                            <a class="btn btn-primary" href="{% url 'createsubscription' %}"
                               role="button">{% trans "Subscribe Now!" %}</a>
                        </div>
                    </div>
                {% endif %}
            </div>
        {% endblock %}
        {% block javascript %}
            <script type="text/javascript">
                $('#cancel-subscription').click(function () {
                    var choice = confirm("{% trans "Please confirm that you want to cancel your subscription." %}");
                    if (choice) {
                        window.location = "{% url 'deletesubscription' %}";
                    }
                });
                $('#changeplanbtbn').click(function () {
                    swal({
                        title: '{{ swalchgbtntitle }}',
                        type: 'warning',
                        showCancelButton: true,
                        confirmButtonText: '{{ swalchgbtnconfirmButtonText }}',
                        cancelButtonText: '{{ swalchgbtncancelButtonText }}',
                        confirmButtonClass: 'btn btn-success',
                        cancelButtonClass: 'btn btn-danger',
                        buttonsStyling: false
                    }).then(function () {
                        swal(
                            '{{ swalchgbtnsuccesstitle }}',
                            '',
                            'success'
                        );
                        window.location = "{% url 'subscription' %}";
                    }, function (dismiss) {
                        // dismiss can be 'cancel', 'overlay',
                        // 'close', and 'timer'
                        if (dismiss === 'cancel') {
                            swal(
                                '{{ swalchgbtncanceltitle }}',
                                '',
                                'error'
                            )
                        }
                    }).catch(swal.noop);
                });

            </script>
        {% endblock %}
    {% else %}
        <h1>Not Logged In....</h1>
    {% endif %}
{% endlocaltime %}

