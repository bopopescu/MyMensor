{% extends 'base.html' %}
{% load i18n staticfiles tz %}
{% localtime on %}
{% get_current_timezone as TIME_ZONE %}
{% block title %}Tag Analysis - {{ block.super }}{% endblock %}

{% block content %}
    <div class="d-flex align-content-start flex-wrap">
        <div class="card card-outline-primary m-2" style="width: 20rem;">
            <div class="card-block">
                <div id="reportrange" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 18rem ">
                    <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>&nbsp;
                    <span id="selcdates"></span> <b class="caret"></b>
                </div>
            </div>
            <div class="card-block">
                <ul class="list-group list-group-flush">
                {% for tagNumber in listofprocessedtagsnumbers %}
                    <li class="list-group-item">
                        <div class="form-check">
                            <label class="form-check-label">
                                <input class="form-check-input" type="checkbox" value="">
                                    Tag #{{ tagNumber }}
                            </label>
                        </div>
                    </li>
                {% endfor %}
                </ul>
            </div>
        </div>
        <div class="card card-outline-primary m-2" style="width: 60rem;">
            <div class="card-block">
                <div id="canvasparent">
                    <div style="height: 100%">
                        <canvas id="canvas"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascript %}
    <script type="text/javascript">
        $(function() {

            var start = moment("{{ start }}");
            var end = moment("{{ end }}");

            function cb(start, end) {
                $('#reportrange span').html(start.format('YYYY-MMM-DD') + ' - ' + end.format('YYYY-MMM-DD'));
            }

            $('#reportrange').daterangepicker({
                startDate: {{ start }},
                endDate: {{ end }},
                "alwaysShowCalendars": true,
                ranges: {
                   'Today': [moment(), moment()],
                   'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                   'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                   'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                   'This Month': [moment().startOf('month'), moment().endOf('month')],
                   'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                }
            }, cb);

            cb(start, end);

            $('#reportrange').on('apply.daterangepicker', function(ev, picker) {
                var startdate = picker.startDate.format('YYYY-MM-DD');
                var enddate = picker.endDate.format('YYYY-MM-DD');
                console.log(startdate);
                console.log(enddate);
                //console.log({% url 'portfolio' %});
                //window.location={% url 'portfolio' %}+'?startdate='+startdate+'&enddate='+enddate+'&qtypervp='+{{ qtypervp }};
            });

        });

    </script>
{% endblock %}

{% block extra_head %}
    <script type="text/javascript" src="{% static "js/Chart.min.js" %}"></script>
    <script type="text/javascript" src="{% static "js/hammer.min.js" %}"></script>
	<script type="text/javascript" src="{% static "js/chartjs-plugin-zoom.js" %}"></script>
    <script type="text/javascript">
        var parent = document.getElementById('canvasparent');

        canvas.width = parent.offsetWidth;
        canvas.height = parent.offsetHeight;

        var config = {
            type: 'line',
            data: {
                datasets: [{
                    label: "My First dataset",
                    backgroundColor: window.chartColors.red,
                    borderColor: window.chartColors.red,
                    data: [{
                        x: -10,
                        y: 0
                    }, {
                        x: 0,
                        y: 10
                    }, {
                        x: 10,
                        y: 5
                    }],
                    fill: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {
                    display: true,
                    position: 'bottom'
                },
                tooltips: {
                    mode: 'index',
                    intersect: false
                },
                hover: {
                    mode: 'nearest',
                    intersect: true
                },
                scales: {
                    xAxes: [{
                        type: 'linear',
                        position: 'bottom',
                        display: true
                    }],
                    yAxes: [{
                        display: true,
                        position: "left"
                    }]
                },
                pan: {
                    enabled: true,
                    mode: 'xy'
                },
                zoom: {
                    enabled: true,
                    mode: 'xy',
                    limits: {
                        max: 10,
                        min: 0.5
                    }
                }
            }
        };

        window.onload = function() {
            var ctx = document.getElementById("canvas").getContext("2d");
            window.myScatter = new Chart(ctx, config);
        };

        document.getElementById('randomizeData').addEventListener('click', function() {
            config.data.datasets.forEach(function(dataset) {
                dataset.data = dataset.data.map(function() {
                    return randomScalingFactor();
                });

            });

            window.myLine.update();
        });

        var colorNames = Object.keys(window.chartColors);

        document.getElementById('addDataset').addEventListener('click', function() {
            var colorName = colorNames[config.data.datasets.length % colorNames.length];
            var newColor = window.chartColors[colorName];
            var newDataset = {
                label: 'Dataset ' + config.data.datasets.length,
                backgroundColor: newColor,
                borderColor: newColor,
                data: [],
                fill: false
            };

            for (var index = 0; index < config.data.labels.length; ++index) {
                newDataset.data.push(randomScalingFactor());
            }

            config.data.datasets.push(newDataset);
            window.myLine.update();
        });


        document.getElementById('removeDataset').addEventListener('click', function() {
            config.data.datasets.splice(0, 1);
            window.myLine.update();
        });

    </script>
{% endblock %}

{% endlocaltime %}